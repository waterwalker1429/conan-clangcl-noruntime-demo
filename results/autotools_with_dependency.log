root@dinm5CG3480110:/# git clone https://github.com/waterwalker1429/conan-clangcl-noruntime-demo.git
Cloning into 'conan-clangcl-noruntime-demo'...
remote: Enumerating objects: 49, done.
remote: Counting objects: 100% (49/49), done.
remote: Compressing objects: 100% (33/33), done.
remote: Total 49 (delta 11), reused 43 (delta 8), pack-reused 0 (from 0)
Receiving objects: 100% (49/49), 13.20 KiB | 1.47 MiB/s, done.
Resolving deltas: 100% (11/11), done.
root@dinm5CG3480110:/# docker build conan-clangcl-noruntime-demo -t clangcl-example-container
[+] Building 1.2s (10/10) FINISHED                                                                                                                                                                                                       docker:default
 => [internal] load build definition from Dockerfile                                                                                                                                                                                               0.0s
 => => transferring dockerfile: 1.53kB                                                                                                                                                                                                             0.0s
 => [internal] load metadata for docker.io/library/debian:bookworm                                                                                                                                                                                 1.2s
 => [internal] load .dockerignore                                                                                                                                                                                                                  0.0s
 => => transferring context: 2B                                                                                                                                                                                                                    0.0s
 => [1/6] FROM docker.io/library/debian:bookworm@sha256:27586f4609433f2f49a9157405b473c62c3cb28a581c413393975b4e8496d0ab                                                                                                                           0.0s
 => CACHED [2/6] RUN apt-get update &&     apt-get install -y     cmake     ninja-build     python3     python3-pip     python3.11-venv     git     curl     wget     gnupg     software-properties-common &&     rm -rf /var/lib/apt/lists/*      0.0s
 => CACHED [3/6] RUN wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key | apt-key add - &&     add-apt-repository "deb http://apt.llvm.org/bookworm/ llvm-toolchain-bookworm main" &&     apt-get update &&     apt-get install -y clang-14 lld  0.0s
 => CACHED [4/6] RUN ln -s /usr/lib/llvm-14/bin/clang /usr/bin/clang-cl &&      for f in /usr/lib/llvm-14/bin/clang*; do update-alternatives --install /usr/bin/$(basename $f) $(basename $f) $f 100; done &&     for f in /usr/lib/llvm-14/bin/l  0.0s
 => CACHED [5/6] RUN python3 -m venv /opt/conan &&     /opt/conan/bin/pip install conan==2.7.0                                                                                                                                                     0.0s
 => CACHED [6/6] WORKDIR /workspace                                                                                                                                                                                                                0.0s
 => exporting to image                                                                                                                                                                                                                             0.0s
 => => exporting layers                                                                                                                                                                                                                            0.0s
 => => writing image sha256:51975a1af8a4a3336969c7aa2b5d0f1b2c03889985f95a7c72f0502a79c9167a                                                                                                                                                       0.0s
 => => naming to docker.io/library/clangcl-example-container                                                                                                                                                                                       0.0s
root@dinm5CG3480110:/# docker run -it -v /conan-clangcl-noruntime-demo:/workspace/example clangcl-example-container /bin/bash
root@e616b1175afd:/workspace# /opt/conan/bin/conan create /workspace/example/dependency -pr:b /workspace/example/build -pr:h /workspace/example/clang-cl

======== Exporting recipe to the cache ========
dependency/0.1: Exporting package recipe: /workspace/example/dependency/conanfile.py
dependency/0.1: Copied 1 '.py' file: conanfile.py
dependency/0.1: Copied 1 '.txt' file: CMakeLists.txt
dependency/0.1: Copied 1 '.h' file: dependency.h
dependency/0.1: Copied 1 '.cpp' file: dependency.cpp
dependency/0.1: Exported to cache folder: /root/.conan2/p/depen86a93a9d71fe8/e
dependency/0.1: Exported: dependency/0.1#971dd3dd9432aaee3f9778dacee278cd (2024-10-16 15:47:51 UTC)

======== Input profiles ========
Profile host:
[settings]
arch=x86_64
build_type=Debug
compiler=clang
compiler.version=14
os=Windows
[buildenv]
CC=clang-cl
CXX=clang-cl

Profile build:
[settings]
arch=x86_64
build_type=Release
compiler=clang
compiler.cppstd=gnu14
compiler.libcxx=libstdc++11
compiler.version=14
os=Linux


======== Computing dependency graph ========
Graph root
    cli
Requirements
    dependency/0.1#971dd3dd9432aaee3f9778dacee278cd - Cache

======== Computing necessary packages ========
dependency/0.1: Forced build from source
Requirements
    dependency/0.1#971dd3dd9432aaee3f9778dacee278cd:c86978c6f2e57fa8155aa6d22158bfea87ef3761 - Build

======== Installing packages ========

-------- Installing package dependency/0.1 (1 of 1) --------
dependency/0.1: Building from source
dependency/0.1: Package dependency/0.1:c86978c6f2e57fa8155aa6d22158bfea87ef3761
dependency/0.1: Copying sources to build folder
dependency/0.1: Building your package in /root/.conan2/p/b/depen3cb7e3c0d68dd/b
dependency/0.1: Calling generate()
dependency/0.1: Generators folder: /root/.conan2/p/b/depen3cb7e3c0d68dd/b/build/Debug/generators
dependency/0.1: CMakeToolchain generated: conan_toolchain.cmake
dependency/0.1: CMakeToolchain generated: /root/.conan2/p/b/depen3cb7e3c0d68dd/b/build/Debug/generators/CMakePresets.json
dependency/0.1: CMakeToolchain generated: /root/.conan2/p/b/depen3cb7e3c0d68dd/b/CMakeUserPresets.json
dependency/0.1: Generating aggregated env files
dependency/0.1: Generated aggregated env files: ['conanbuild.sh', 'conanrun.bat']
dependency/0.1: Calling build()
dependency/0.1: Running CMake.configure()
dependency/0.1: RUN: cmake -G "Unix Makefiles" -DCMAKE_TOOLCHAIN_FILE="generators/conan_toolchain.cmake" -DCMAKE_INSTALL_PREFIX="/root/.conan2/p/b/depen3cb7e3c0d68dd/p" -DCMAKE_POLICY_DEFAULT_CMP0091="NEW" -DCMAKE_BUILD_TYPE="Debug" "/root/.conan2/p/b/depen3cb7e3c0d68dd/b"
-- Using Conan toolchain: /root/.conan2/p/b/depen3cb7e3c0d68dd/b/build/Debug/generators/conan_toolchain.cmake
-- Conan toolchain: Defining architecture flag: -m64
-- Conan toolchain: Setting BUILD_SHARED_LIBS = OFF
-- The CXX compiler identification is Clang 14.0.6 with MSVC-like command-line
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - failed
-- Detecting CXX compile features
-- Detecting CXX compile features - failed
-- Configuring done
-- Generating done
-- Build files have been written to: /root/.conan2/p/b/depen3cb7e3c0d68dd/b/build/Debug

dependency/0.1: Running CMake.build()
dependency/0.1: RUN: cmake --build "/root/.conan2/p/b/depen3cb7e3c0d68dd/b/build/Debug" -- -j28
[ 50%] Building CXX object CMakeFiles/dependency.dir/src/dependency.cpp.obj
[100%] Linking CXX static library dependency.lib
[100%] Built target dependency

dependency/0.1: Package 'c86978c6f2e57fa8155aa6d22158bfea87ef3761' built
dependency/0.1: Build folder /root/.conan2/p/b/depen3cb7e3c0d68dd/b/build/Debug
dependency/0.1: Generating the package
dependency/0.1: Packaging in folder /root/.conan2/p/b/depen3cb7e3c0d68dd/p
dependency/0.1: Calling package()
dependency/0.1: Running CMake.install()
dependency/0.1: RUN: cmake --install "/root/.conan2/p/b/depen3cb7e3c0d68dd/b/build/Debug" --prefix "/root/.conan2/p/b/depen3cb7e3c0d68dd/p"
-- Install configuration: "Debug"
-- Installing: /root/.conan2/p/b/depen3cb7e3c0d68dd/p/lib/dependency.lib
-- Installing: /root/.conan2/p/b/depen3cb7e3c0d68dd/p/include/dependency.h

dependency/0.1: package(): Packaged 1 '.lib' file: dependency.lib
dependency/0.1: package(): Packaged 1 '.h' file: dependency.h
dependency/0.1: Created package revision 5994049f2fd46d1ffcf19167e64ac333
dependency/0.1: Package 'c86978c6f2e57fa8155aa6d22158bfea87ef3761' created
dependency/0.1: Full package reference: dependency/0.1#971dd3dd9432aaee3f9778dacee278cd:c86978c6f2e57fa8155aa6d22158bfea87ef3761#5994049f2fd46d1ffcf19167e64ac333
dependency/0.1: Package folder /root/.conan2/p/b/depen3cb7e3c0d68dd/p
root@e616b1175afd:/workspace# /opt/conan/bin/conan create /workspace/example/autotools -pr:b /workspace/example/build -pr:h /workspace/example/clang-cl

======== Exporting recipe to the cache ========
mypkg/0.1: Exporting package recipe: /workspace/example/autotools/conanfile.py
mypkg/0.1: Copied 1 '.py' file: conanfile.py
mypkg/0.1: Copied 1 '.ac' file: configure.ac
mypkg/0.1: Copied 2 '.am' files: Makefile.am, Makefile.am
mypkg/0.1: Copied 1 '.cpp' file: mypkg.cpp
mypkg/0.1: Copied 1 '.h' file: mypkg.h
mypkg/0.1: Exported to cache folder: /root/.conan2/p/mypkge501210cd6af0/e
mypkg/0.1: Exported: mypkg/0.1#71f80bd7fe71dd01e1ff528b29351064 (2024-10-16 15:47:58 UTC)

======== Input profiles ========
Profile host:
[settings]
arch=x86_64
build_type=Debug
compiler=clang
compiler.version=14
os=Windows
[buildenv]
CC=clang-cl
CXX=clang-cl

Profile build:
[settings]
arch=x86_64
build_type=Release
compiler=clang
compiler.cppstd=gnu14
compiler.libcxx=libstdc++11
compiler.version=14
os=Linux


======== Computing dependency graph ========
Graph root
    cli
Requirements
    dependency/0.1#971dd3dd9432aaee3f9778dacee278cd - Cache
    mypkg/0.1#71f80bd7fe71dd01e1ff528b29351064 - Cache

======== Computing necessary packages ========
mypkg/0.1: Forced build from source
Requirements
    dependency/0.1#971dd3dd9432aaee3f9778dacee278cd:c86978c6f2e57fa8155aa6d22158bfea87ef3761#5994049f2fd46d1ffcf19167e64ac333 - Cache
    mypkg/0.1#71f80bd7fe71dd01e1ff528b29351064:837d1f88bfd588799aee9a7264804e103c74bed2 - Build

======== Installing packages ========
dependency/0.1: Already installed! (1 of 2)

-------- Installing package mypkg/0.1 (2 of 2) --------
mypkg/0.1: Building from source
mypkg/0.1: Package mypkg/0.1:837d1f88bfd588799aee9a7264804e103c74bed2
mypkg/0.1: Copying sources to build folder
mypkg/0.1: Building your package in /root/.conan2/p/b/mypkgaaf899e5d4183/b
mypkg/0.1: Calling generate()
mypkg/0.1: Generators folder: /root/.conan2/p/b/mypkgaaf899e5d4183/b/build-debug/conan
ERROR: win_bash=True but tools.microsoft.bash:subsystem configuration not defined
root@e616b1175afd:/workspace# cat /root/.conan2/p/b/
depen3cb7e3c0d68dd/ mypkgaaf899e5d4183/
root@e616b1175afd:/workspace# cat /root/.conan2/p/b/mypkgaaf899e5d4183/b/build-debug/conan/conanautotoolsdeps.sh
script_folder="/root/.conan2/p/b/mypkgaaf899e5d4183/b/build-debug/conan"
echo "echo Restoring environment" > "$script_folder/deactivate_conanautotoolsdeps.sh"
for v in CPPFLAGS LIBS LDFLAGS CXXFLAGS CFLAGS
do
    is_defined="true"
    value=$(printenv $v) || is_defined="" || true
    if [ -n "$value" ] || [ -n "$is_defined" ]
    then
        echo export "$v='$value'" >> "$script_folder/deactivate_conanautotoolsdeps.sh"
    else
        echo unset $v >> "$script_folder/deactivate_conanautotoolsdeps.sh"
    fi
done


export CPPFLAGS="$CPPFLAGS -I/root/.conan2/p/b/depen3cb7e3c0d68dd/p/include"
export LIBS="$LIBS -ldependency"
export LDFLAGS="$LDFLAGS -L/root/.conan2/p/b/depen3cb7e3c0d68dd/p/lib"
export CXXFLAGS="$CXXFLAGS"
export CFLAGS="$CFLAGS"root@e616b1175afd:/workspace#